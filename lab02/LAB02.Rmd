---
title: "Lab02"
author: "Jose Manoel Ferreira"
date: "1 de outubro de 2018"
output: html_document
---

``` {r prepare, cache=TRUE, message=FALSE, warning=FALSE}

  # campos:
  # "sequencial_candidato" :(character) id do candidato
  # "nome": (character)
  # "uf": (character)
  # "partido": (character)
  # "quantidade_doacoes": (integer)
  # "quantidade_doadores": (integer) número de doadores diferentes
  # "total_receita": (double) soma em R$ das doações
  # "media_receita": (double) média das doações
  # "recursos_de_outros_candidatos/comites": (double) quantia em R$ das doações provenientes de outros candidatos ou comite partidário
  # "recursos_de_pessoas_fisicas": (double) quantia em R$ das doações provenientes de outros CPFs
  # "recursos_de_pessoas_juridicas": (double) quantia em R$ das doações provenientes de outros CNPJ
  # "recursos_proprios": (double) quantia em R$ das doações provenientes do próprio candidato
  # "recursos_de_partido_politico": (double) quantia em R$ das doações provenientes do partido político do candidato
  # "votos": (integer) variável alvo. Se refere ao número de votos na campanha de 2006 e 2010
  # "quantidade_despesas": (integer)
  # "quantidade_fornecedores": (integer) número de fornecedores/despesas diferentes
  # "total_despesa": (double) soma em R$ das despesas de campanha
  # "media_despesa": (double) média das despesas de campanha
  # "cargo": (character)
  # "Sexo":  (character)
  # "grau": (character) grau de instrução do candidato
  # "estado_civil": (character)
  # "ocupacao": (character) ocupação do candidato



setwd("~/git/data-analysis/lab02/")




data2006 <- read.csv(("data/eleicoes_2006.csv"))
data2010 <- read.csv(("data/eleicoes_2010.csv"))


library(reshape)
library(ggplot2)
library(dplyr)
library(lattice)
library(scales)
library(corrplot)
library("PerformanceAnalytics")
library(GGally)
```

```{r hist,warning=FALSE, message=FALSE}
data2006$sexo <- as.factor(data2006$sexo)
data2006$estado_civil <- as.factor(data2006$estado_civil)
data2006$uf <- as.factor(data2006$uf)
data2006$sexo <- as.factor(data2006$sexo)
data2006$grau <- as.factor(data2006$grau)
data2006$estado_civil <- as.factor(data2006$estado_civil)
data2006$ocupacao <- as.factor(data2006$ocupacao)

```


In order to normalize the vaiable log function was applaied in the variables quantidade_doacoes, quantidade_doadores, quantidade_despesas and votos.



```{r hist,warning=FALSE, message=FALSE}
d = melt(select(data2006, -sequencial_candidato, - ano))
ggplot(d,aes(x = value)) + 
    facet_wrap(~variable, scales = "free_x") + 
    scale_x_continuous(labels = comma) +
    geom_histogram()
```


```{r hist,warning=FALSE, message=FALSE,}

datacorrelation1 <- data2006 %>% select(-c(sequencial_candidato, nome, estado_civil, ano, cargo))


```

Seeing the correlation betweend the variables we can say that the variable whit the best correlation whit votos is total_despesa 0.658 flollowed by total_receita 0.635 whitch makes 
totally sense, because the total_receita is the values used to pay the expense and its represented by total_despesas.



```{r hist,warning=FALSE, message=FALSE, fig.height=15,fig.width=15}
datacorrelation <- datacorrelation1 %>%
  mutate(uf = as.numeric(uf)) %>%
  mutate(partido = as.numeric(partido)) %>%
  mutate(sexo = as.numeric(sexo)) %>%
  mutate(grau = as.numeric(grau)) %>%
  mutate(ocupacao = as.numeric(ocupacao))
  round(2)

ggpairs(datacorrelation, axisLabels = "none")
```

Multiple Regression Linear Model Whit all numeric variables

1. A multiple regresson model whit all variables is able to explain the y variation (total of votos) in 2006 and 2010?

As we can see we've got a $ R_a^2 $ and $ R^2 $ whit 0.5779 and  0.5488 respectively. As close to 1 is better to explain the model, but it seems not enough and even adjusting the R-squared we got a minimum increasing. So the model whit all variables does not weel explains the total of votos.

    
```{r hist,warning=FALSE, message=FALSE}

data2006.lm = lm(data2006$votos ~ data2006$uf + data2006$partido  + data2006$quantidade_doacoes + data2006$quantidade_doadores + data2006$total_receita + data2006$media_receita + data2006$recursos_de_outros_candidatos.comites + data2006$recursos_de_pessoas_fisicas + data2006$recursos_de_pessoas_juridicas + data2006$recursos_proprios + data2006$recursos_de_partido_politico + data2006$quantidade_despesas + data2006$quantidade_fornecedores + data2006$total_despesa + data2006$media_despesa + data2006$sexo + data2006$grau + data2006$estado_civil + data2006$ocupacao)

summary(data2006.lm)

```

2. Compare as regressões construídas para 2006 e 2010. Quais as diferenças/semelhanças percebidas? Algumas sugestões:
  1. Analise os plots de resíduos e verifique se há tendências nos erros para cada ano.
  2. Quais variáveis conseguem explicar melhor o número de votos? Compare essas variáveis entre os modelos. Mesma coisa para as variáveis menos explicativas.
  3. Compare os valores de R2 e RSE considerando as regressões para cada ano.
  4. Inclua outros pontos de comparação que você ache interessante.


```{r}
data2006.residuals = resid(data2006.lm) 

densityplot(data2006.residuals)
```
3. Todas as variáveis são úteis para os modelos de regressão? Há variáveis redudantes? Faça análises para 2006 e 2010 separadamente. 
3. Are all variables useful to the regression model? is there any redundant varialbe? Alaysis to 2006 and 2010 separately.
No, not all variable are usefull to the model, for example cargo, there is only one cargo and year which is DEPUTADO FEDERAL and 2006 respectively. Also there is redudant variables, media_receita which is the mediam of all receita so it have a strong correlation whit total_receita, so it not necessary to have both variables in the model.


4. No caso de haver variáveis pouco explicativas e/ou redudantes, construa um novo modelo sem essas variáveis e o compare ao modelo com todas as variáveis (e.g. em termos de R2 e RSE). Faça isso para 2006 e 2010 separadamente.
4. If there is redudant variables or not explained, make a new model excluding those variables and compare the new model with the one that has all variables (e.g. should explain using R2 and RSE)

5. Construa agora uma regressão considerando os anos 2006 e 2010 em conjunto. Que diferenças/semelhanças você percebe em relação aos modelos individuais por ano? Veja a questão 2 para sugestões que você usar para comparação.

Uma das formas de avaliar a qualidade do ajuste do modelo é através do coeficiente de determinação. Basicamente, este coeficiente indica quanto o modelo foi capaz de explicar os dados coletados. O coeficiente de determinação é dado pela expressão.

0 < $ R^2 $ < 1

O $ R^2 $ é, portanto, uma medida descritiva da qualidade do ajuste obtido. Em geral referimo-nos ao $ R^2 $ como a quantidade de variabilidade nos dados que é explicada pelo modelo de regressão ajustado. Entretanto, o valor do coeficiente de determinação depende do número de observações $ (n) $, tendendo a crescer quando $ n $ diminui

O $ R^2 $ deve ser usado com precaução, pois é sempre possível torná-lo maior pela adição de um número suficiente de termos ao modelo. Assim, se, por exemplo, não há dados repetidos (mais do que um valor $ y $ para um mesmo $ x $) um polinômio de grau $ (n - 1) $ dará um ajuste perfeito $ (R^2 = 1) $ para $ n $ dados. Quando há valores repetidos, o $ R^2 $ não será nunca igual a 1, pois o modelo não poderá explicar a variabilidade devido ao erro puro.

Para evitar dificuldades na interpretação de $ R^2 $, alguns estatísticos preferem usar o $ R_a^2 $ ($ R^2 $ ajustado), definido para uma equação com 2 coeficientes como



$$R^2_a=1-\left(\frac{n-1}{n-2}\right)(1-R^2).$$	
Assim como o Coeficiente de Determinação $ R^2 $, quanto maior $ R_a^2 $, mais a variável resposta é explicada pela regressora X.


http://www.portalaction.com.br/analise-de-regressao/16-coeficiente-de-determinacao 

